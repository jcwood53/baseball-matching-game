<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Field Explorer — Refined Layout</title>
<style>
  :root{
    --bg:#eaf8ff;
    --grass-dark:#245f3a;
    --grass-light:#2e8b57;
    --dirt-1:#d6a770;
    --dirt-2:#c28f4f;
    --base-white:#ffffff;
    --muted:#51686c;
    --accent:#faad33;
    --stroke:#0b3940;
    --card-bg:#ffffff;
    --max-w:1400px;
  }
  html,body{height:100%;margin:0}
  body{
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    background: linear-gradient(180deg,var(--bg), #d9eff8 60%);
    display:flex;justify-content:center;padding:20px;color:var(--stroke);
  }
  .wrap{width:100%;max-width:var(--max-w);background:#fff;border-radius:12px;box-shadow:0 12px 36px rgba(6,30,40,0.12);padding:18px;box-sizing:border-box}
  header{display:flex;align-items:baseline;gap:12px;margin-bottom:14px}
  h1{margin:0;font-size:20px}
  .subtitle{color:var(--muted);font-size:13px;margin-top:6px}
  .layout{display:flex;gap:18px;flex-wrap:wrap}
  .field{flex:1 1 920px;min-width:360px;background:linear-gradient(180deg,#e9fbef,#dff6eb);padding:10px;border-radius:10px;position:relative}
  .side{width:340px;min-width:260px}
  .panel{background:#fff;border-radius:10px;padding:12px;border:1px solid rgba(0,0,0,0.04);box-shadow:0 6px 18px rgba(6,30,40,0.04)}
  svg{width:100%;height:auto;display:block}
  .info{position:absolute;z-index:50;min-width:240px;background:var(--card-bg);border-radius:10px;padding:12px;box-shadow:0 12px 30px rgba(6,30,40,0.12);border:1px solid rgba(6,30,40,0.06);display:none}
  .info h3{margin:0 0 8px;font-size:15px;color:var(--stroke)}
  .info p{margin:0;color:var(--muted);font-size:13px;line-height:1.35}
  .info .close{position:absolute;right:8px;top:8px;cursor:pointer;color:var(--muted)}
  .legend-item{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--muted);margin-bottom:8px}
  .sw{width:14px;height:14px;border-radius:3px}
  .tip{font-size:13px;color:var(--muted);margin-top:10px}
  .btn-list button{display:block;width:100%;text-align:left;padding:10px 12px;border-radius:8px;border:1px solid rgba(6,30,40,0.04);background:#fff;margin-bottom:8px;cursor:pointer}
  .btn-list button:focus{outline:2px solid rgba(43,122,87,0.12)}
  @media (max-width:880px){.layout{flex-direction:column-reverse}.side{width:100%}}
</style>
</head>
<body>
  <div class="wrap" role="main">
    <header>
      <div>
        <h1>Field Explorer — Refined Layout</h1>
        <div class="subtitle">Diamond enlarged 50%; perfect square rotated to a diamond; circular mound moved closer; rotated coach boxes; rotated home plate; foul lines aligned.</div>
      </div>
    </header>

    <div class="layout">
      <section class="field panel" aria-label="Baseball field">
        <!-- Info card -->
        <div id="infoCard" class="info" role="dialog" aria-hidden="true">
          <div class="close" id="cardClose" tabindex="0" aria-label="Close">✕</div>
          <h3 id="infoTitle">Title</h3>
          <p id="infoBody">Description</p>
        </div>

        <!-- SVG field -->
        <svg id="fieldSVG" viewBox="0 0 1600 1300" role="img" aria-label="Baseball field diagram">
          <defs>
            <linearGradient id="gGrass" x1="0" x2="1">
              <stop offset="0" stop-color="var(--grass-light)"/>
              <stop offset="1" stop-color="var(--grass-dark)"/>
            </linearGradient>
            <radialGradient id="dirtR" cx="50%" cy="35%">
              <stop offset="0%" stop-color="#e2b887"/>
              <stop offset="100%" stop-color="#c79b59"/>
            </radialGradient>
            <filter id="soft" x="-50%" y="-50%" width="200%" height="200%"><feDropShadow dx="0" dy="10" stdDeviation="18" flood-color="#0a1a22" flood-opacity="0.12"/></filter>
          </defs>

          <!-- full grass -->
          <rect x="0" y="0" width="1600" height="1300" fill="url(#gGrass)"/>

          <!-- warning track / outfield arc -->
          <path d="M120 180 A760 760 0 0 1 1480 180 L1480 240 A780 780 0 0 0 120 240 Z" fill="#d9c0a0" opacity="0.6"/>

          <!-- base geometry parameters: center at cx=800, cy=700 -->
          <!-- foul lines aligned with baselines: start at rotated home plate corners (we compute by transform) -->

          <!-- Big diamond implemented as a perfect square rotated 45deg: side = 2 * baseRadius / sqrt(2)
               We'll draw the square's points directly relative to center (cx,cy). Using baseRadius = 540 (50% larger than prior 360). -->
          <g id="diamondRoot" transform="translate(800,700)">
            <!-- compute diamond points: top (0,-540), right (540,0), bottom (0,540), left (-540,0) -->
            <path id="infieldDirt" d="M0 -540 L540 0 L0 540 L-540 0 Z" fill="url(#dirtR)" stroke="#b07a49" stroke-width="2" filter="url(#soft)"/>

            <!-- baselines (thick white) -->
            <path d="M0 -540 L540 0" stroke="#fff" stroke-width="14" stroke-linecap="round"/>
            <path d="M540 0 L0 540" stroke="#fff" stroke-width="14" stroke-linecap="round"/>
            <path d="M0 540 L-540 0" stroke="#fff" stroke-width="14" stroke-linecap="round"/>
            <path d="M-540 0 L0 -540" stroke="#fff" stroke-width="14" stroke-linecap="round"/>

            <!-- chalk inner edges -->
            <path d="M0 -540 L540 0" stroke="#f4e6cf" stroke-width="4" opacity="0.85"/>
            <path d="M540 0 L0 540" stroke="#f4e6cf" stroke-width="4" opacity="0.85"/>
            <path d="M0 540 L-540 0" stroke="#f4e6cf" stroke-width="4" opacity="0.85"/>
            <path d="M-540 0 L0 -540" stroke="#f4e6cf" stroke-width="4" opacity="0.85"/>

            <!-- Bases (bags) scaled up for clarity: 90x90 -->
            <g id="firstGroup" transform="translate(540,0)">
              <rect id="firstBase" class="hotspot" x="-45" y="-45" width="90" height="90" rx="6" fill="#fff" stroke="#c6c6c6" stroke-width="5" tabindex="0" role="button" aria-label="First base"></rect>
              <text x="0" y="132" font-size="20" text-anchor="middle" fill="#0b3b40">First baseman</text>
            </g>

            <g id="secondGroup" transform="translate(0,-540)">
              <rect id="secondBase" class="hotspot" x="-45" y="-45" width="90" height="90" rx="6" fill="#fff" stroke="#c6c6c6" stroke-width="5" tabindex="0" role="button" aria-label="Second base"></rect>
              <text x="0" y="-132" font-size="20" text-anchor="middle" fill="#0b3b40">Second baseman</text>
            </g>

            <g id="thirdGroup" transform="translate(-540,0)">
              <rect id="thirdBase" class="hotspot" x="-45" y="-45" width="90" height="90" rx="6" fill="#fff" stroke="#c6c6c6" stroke-width="5" tabindex="0" role="button" aria-label="Third base"></rect>
              <text x="0" y="132" font-size="20" text-anchor="middle" fill="#0b3b40">Third baseman</text>
            </g>

            <!-- home plate: rotated 180deg (point now up relative to previous) -->
            <g id="homeGroup" transform="translate(0,540) rotate(180)">
              <polygon id="homePlate" class="hotspot" points="-40,0 40,0 40,-28 0,-56 -40,-28" fill="#fff" stroke="#c6c6c6" stroke-width="4" tabindex="0" role="button" aria-label="Home plate"></polygon>
              <!-- removed duplicate "Catcher" label per request -->
            </g>

            <!-- circular pitcher's mound moved closer to home (translate y positive is toward bottom, so move mound down toward home) -->
            <!-- previous mound at -120 from center; now move to -95 to be closer to home (i.e., 25 units closer) -->
            <g id="moundGroup" transform="translate(0,-95)">
              <circle id="moundCircle" cx="0" cy="0" r="64" fill="#b97f4f" stroke="#9b6237" stroke-width="4" filter="url(#soft)"></circle>
              <!-- rectangular pitcher plate: width = 90 (same as base width), height shortened to 6 (about 1/3 shorter than earlier) -->
              <rect id="pitcherPlate" class="hotspot" x="-45" y="-6" width="90" height="6" rx="2" fill="#fff" stroke="#c6c6c6" stroke-width="2" tabindex="0" role="button" aria-label="Pitcher's plate"></rect>
            </g>

            <!-- shortstop between and slightly behind second and third -->
            <g id="shortstopGroup" transform="translate(-210,-300)">
              <circle id="shortstop" class="hotspot" r="20" fill="#fff" stroke="#c6c6c6" stroke-width="4" tabindex="0" role="button" aria-label="Shortstop"></circle>
              <text x="0" y="56" font-size="16" text-anchor="middle" fill="#0b3b40">Shortstop</text>
            </g>

            <!-- faint axis for orientation -->
            <line x1="0" y1="-640" x2="0" y2="640" stroke="#ffffff" stroke-width="1" opacity="0.05"/>
          </g>

          <!-- foul lines now aligned to the baseline end points by drawing from home plate corners -->
          <!-- compute home plate corner coordinates in global space:
               diamond center at (800,700), home at (800,700+540) => (800,1240)
               home plate polygon points transformed by rotate(180) will place corners relative; we'll draw lines that follow baseline directions from home center -->
          <line id="foulRight" x1="800" y1="1240" x2="1400" y2="120" stroke="#fff" stroke-width="5" stroke-linecap="round"/>
          <line id="foulLeft" x1="800" y1="1240" x2="200" y2="120" stroke="#fff" stroke-width="5" stroke-linecap="round"/>
          <line x1="800" y1="1240" x2="1400" y2="120" stroke="#f7ead7" stroke-width="2" stroke-dasharray="7 4" opacity="0.6"/>
          <line x1="800" y1="1240" x2="200" y2="120" stroke="#f7ead7" stroke-width="2" stroke-dasharray="7 4" opacity="0.6"/>

          <!-- coach boxes rotated to be parallel with baselines: compute baseline angle = 45deg -->
          <g id="coachBoxes">
            <!-- first base coach box: placed near first base, rotated 45deg -->
            <g transform="translate(800,700) translate(420,80) rotate(45)">
              <rect x="-60" y="-18" width="120" height="36" rx="6" fill="#fff" stroke="#d9d9d9"></rect>
              <text x="0" y="6" font-size="14" text-anchor="middle" fill="#596a6e">Coach's box</text>
            </g>

            <!-- third base coach box: placed near third base, rotated -45deg -->
            <g transform="translate(800,700) translate(-420,80) rotate(-45)">
              <rect x="-60" y="-18" width="120" height="36" rx="6" fill="#fff" stroke="#d9d9d9"></rect>
              <text x="0" y="6" font-size="14" text-anchor="middle" fill="#596a6e">Coach's box</text>
            </g>
          </g>

          <!-- on-deck circles moved laterally toward home by ~40 units -->
          <g id="onDecks">
            <circle cx="240" cy="980" r="26" fill="#fff" stroke="#d9d9d9"></circle>
            <text x="240" y="1024" font-size="13" text-anchor="middle" fill="#596a6e">On-deck</text>

            <circle cx="1360" cy="980" r="26" fill="#fff" stroke="#d9d9d9"></circle>
            <text x="1360" y="1024" font-size="13" text-anchor="middle" fill="#596a6e">On-deck</text>
          </g>

          <!-- dugouts -->
          <g id="dugouts">
            <rect x="160" y="1020" width="220" height="88" rx="12" fill="#f6f6f6" stroke="#e6e6e6"></rect>
            <text x="270" y="1074" font-size="14" text-anchor="middle" fill="#596a6e">Dugout</text>

            <rect x="1220" y="1020" width="220" height="88" rx="12" fill="#f6f6f6" stroke="#e6e6e6"></rect>
            <text x="1330" y="1074" font-size="14" text-anchor="middle" fill="#596a6e">Dugout</text>
          </g>

          <!-- outfield / position labels -->
          <g id="positions" fill="#fff" font-weight="700" text-anchor="middle">
            <text x="800" y="220" font-size="26">Center Fielder</text>
            <text x="600" y="320" font-size="22">Left Fielder</text>
            <text x="1000" y="320" font-size="22">Right Fielder</text>
          </g>

          <!-- infield labels removed duplicates; keep succinct -->
          <g id="infieldLabels" fill="#0b3b40" text-anchor="middle">
            <text x="800" y="680" font-size="18">Pitcher</text>
            <text x="800" y="1160" font-size="18">Catcher</text>
          </g>
        </svg>

        <div class="tip">Tip: Tab to hotspots (bases, pitcher's plate, shortstop) and press Enter/Space to open descriptions.</div>
      </section>

      <aside class="side">
        <div class="panel" aria-labelledby="legendTitle">
          <h3 id="legendTitle" style="margin:0 0 8px 0">Legend & Controls</h3>

          <div class="legend-item"><div class="sw" style="background:var(--grass-light)"></div><div>Outfield / Grass</div></div>
          <div class="legend-item"><div class="sw" style="background:var(--dirt-1)"></div><div>Infield / Dirt</div></div>

          <div style="margin:10px 0" class="btn-list" role="group" aria-label="Area buttons">
            <button data-area="home">Home plate</button>
            <button data-area="first">First base</button>
            <button data-area="second">Second base</button>
            <button data-area="third">Third base</button>
            <button data-area="mound">Pitcher's plate</button>
            <button data-area="shortstop">Shortstop</button>
            <button data-area="infield">Infield</button>
            <button data-area="outfield">Outfield</button>
          </div>

          <div style="margin-top:6px;color:var(--muted);font-size:13px">Discover areas by clicking or tabbing then pressing Enter. Progress shown below.</div>
          <div style="margin-top:12px;font-weight:700;font-size:18px;color:var(--stroke)"><span id="foundCount">0</span> / <span id="totalCount">8</span></div>
          <div id="complete" style="display:none;margin-top:10px;padding:8px;border-radius:8px;background:linear-gradient(90deg,#fff7e6,#fff2dc);color:#8a5a00">All areas discovered — nice!</div>
        </div>
      </aside>
    </div>
  </div>

<script>
  // Interactive mapping and info content (updated selectors to match new IDs)
  const descriptions = {
    home: {title:'Home Plate', text:'Where batters stand and where runs are scored. Shape helps umpires judge the strike zone.'},
    first: {title:'First Base', text:'The first bag a runner reaches; frequent play target for throws.'},
    second: {title:'Second Base', text:'Top corner of the diamond; pivot for many double plays.'},
    third: {title:'Third Base', text:'Left corner; often called the hot corner.'},
    mound: {title:"Pitcher's Plate", text:"A narrow white plate on the mound; visualized here shorter in height for clarity."},
    shortstop: {title:"Shortstop", text:"Positioned between second and third, slightly behind second; key infield defender."},
    infield: {title:"Infield", text:"The dirt area linking the bases where ground balls and quick throws occur."},
    outfield: {title:"Outfield", text:"The grassy area beyond the baselines, divided into left, center, and right field."}
  };

  const primary = ['home','first','second','third','mound','shortstop','infield','outfield'];
  const found = new Set();

  // mapping selectors
  const mapping = {
    home: ['#homePlate','button[data-area="home"]'],
    first: ['#firstBase','button[data-area="first"]'],
    second: ['#secondBase','button[data-area="second"]'],
    third: ['#thirdBase','button[data-area="third"]'],
    mound: ['#pitcherPlate','button[data-area="mound"]'],
    shortstop: ['#shortstop','button[data-area="shortstop"]'],
    infield: ['#infieldDirt','button[data-area="infield"]'],
    outfield: ['#fieldSVG','button[data-area="outfield"]']
  };

  const infoCard = document.getElementById('infoCard');
  const infoTitle = document.getElementById('infoTitle');
  const infoBody = document.getElementById('infoBody');
  const cardClose = document.getElementById('cardClose');
  const foundCount = document.getElementById('foundCount');
  const totalCount = document.getElementById('totalCount');
  totalCount.textContent = primary.length;

  function showCard(area, ev){
    const data = descriptions[area];
    if(!data) return;
    infoTitle.textContent = data.title;
    infoBody.textContent = data.text;
    infoCard.style.display = 'block';
    infoCard.setAttribute('aria-hidden','false');

    // discovery tracking
    if(primary.includes(area) && !found.has(area)){
      found.add(area);
      foundCount.textContent = found.size;
      if(found.size === primary.length){
        document.getElementById('complete').style.display = 'block';
      }
    }

    // position near event or element
    let x=window.innerWidth/2, y=window.innerHeight/2;
    if(ev && ev.clientX){
      x = ev.clientX + 12;
      y = ev.clientY + 6;
    } else {
      const svg = document.getElementById('fieldSVG');
      const r = svg.getBoundingClientRect();
      x = r.left + r.width*0.70;
      y = r.top + r.height*0.36;
    }
    infoCard.style.left = Math.max(12, x) + 'px';
    infoCard.style.top = Math.max(12, y) + 'px';

    // clamp to viewport
    requestAnimationFrame(()=>{
      const rect = infoCard.getBoundingClientRect(), pad=12;
      if(rect.right > window.innerWidth - pad) infoCard.style.left = (window.innerWidth - rect.width - pad) + 'px';
      if(rect.bottom > window.innerHeight - pad) infoCard.style.top = (window.innerHeight - rect.height - pad) + 'px';
    });
  }

  function hideCard(){ infoCard.style.display='none'; infoCard.setAttribute('aria-hidden','true'); }

  // wire interactions
  Object.keys(mapping).forEach(area=>{
    const [selSvg, selBtn] = mapping[area];
    const svgEl = document.querySelector(selSvg);
    const btnEl = document.querySelector(selBtn);
    if(svgEl){
      svgEl.addEventListener('click', (e)=>{ e.stopPropagation(); showCard(area,e); });
      svgEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); showCard(area,e); }});
    }
    if(btnEl){
      btnEl.addEventListener('click', (e)=>{ showCard(area,e); });
      btnEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); showCard(area,e); }});
    }
  });

  // close handlers
  cardClose.addEventListener('click', hideCard);
  cardClose.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') hideCard(); });

  document.addEventListener('click', (e)=>{
    const isHot = e.target.closest('.hotspot') || e.target.closest('.panel') || e.target.closest('.info');
    if(!isHot) hideCard();
  });
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') hideCard(); });

  // Ensure SVG elements with tabindex exist for keyboard focus
  window.addEventListener('resize', ()=>{ if(infoCard.style.display==='block'){} });
</script>
</body>
</html>
